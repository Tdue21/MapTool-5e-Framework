[h:tokenName=json.get(macro.args,"tokenName")]
[h:id=findToken(tokenName)]
[h:switchToken(id)]

[h:attributeList=getLibProperty("Attributes", "Lib:Character")]
[h:AtrProps=""]
[h,count(listcount(attributeList),""),code:{
	[h:attribute=listget(attributeList,roll.count)]
	[h:value=getLibProperty(attribute,tokenName)]
	[h:value=getStrProp(value,"value")]
	[h:value=if(value=="",0,value)]
	[h,if(isNumber(value)==0):value=eval(value);value]
	[h:mod=floor(number(eval(string(value)))/2-5)]
	[h:AtrProps=setStrProp(AtrProps,substring(lower(attribute),0,3),mod)]
}]
[h:varsFromStrProp(AtrProps)]

[h:law=json.get(macro.args,"law")]
[h:moral=json.get(macro.args,"moral")]
[h:AC=json.get(macro.args,"AC")]
[h:HitPoints=json.get(macro.args,"HP")]
[h:Personality=json.get(macro.args,"Personality")]
[h:Ideals=json.get(macro.args,"Ideals")]
[h:Bonds=json.get(macro.args,"Bonds")]
[h:Flaws=json.get(macro.args,"Flaws")]
[h:Age=json.get(macro.args,"Age")]
[h:Height=json.get(macro.args,"Height")]
[h:Weight=json.get(macro.args,"Weight")]
[h:Eyes=json.get(macro.args,"Eyes")]
[h:Skin=json.get(macro.args,"Skin")]
[h:Hair=json.get(macro.args,"Hair")]
[h:backstory=json.get(macro.args,"backstory")]

<!-----------------Alignment------------------->
[h:alignment=law+" "+moral]
[h:alignment=if(alignment=="Neutral Neutral","True Neutral",alignment)]
[h:alignment=if(alignment=="- -","",alignment)]
[h:alignment=if(matches(alignment,".*-.*")==1,replace(alignment,"-","Neutral"),alignment)]
[h:props=setStrProp("","value",alignment)]
[h:setProperty("Alignment",props,id)]
<!-----------------Armor Class------------------->
[h:props=setStrProp("","value",AC)]
[h:setProperty("AC",props,id)]
<!-----------------Hit Points------------------->
[h,if(isNumber(HitPoints)==0 && HitPoints!=""):HitPoints=eval(HitPoints)]
[h:HitPoints=if(HitPoints=="" || isNumber(HitPoints)==0,0,HitPoints)]
[h:setProperty("Total Hit Points",HitPoints,id)]
[h:CurrentHP=getProperty("Current Hit Points",id)]
[h:tempHP=getProperty("Temporary Hit Points",id)]
[h,if(isNumber(CurrentHP)==0):setProperty("Current Hit Points",HitPoints,id)]
[h,if(isNumber(tempHP)==0):setProperty("Temporary Hit Points",0,id)]
<!-----------------Personality------------------->
[h:value=json.fromStrProp("Backstory="+backstory+";Personality="+Personality+";Ideals="+Ideals+";Flaws="+Flaws+";Bonds="+Bonds+";Allies=;AditionalFeats=;Treasure=")]
[h:setProperty("OtherNotes",value,id)]
<!-----------------Description------------------->
[h:props=setStrProp("","value",Age)]
[h:setProperty("Age",props,id)]
[h:props=setStrProp("","value",Height)]
[h:setProperty("Height",props,id)]
[h:props=setStrProp("","value",Weight)]
[h:setProperty("Weight",props,id)]
[h:props=setStrProp("","value",Eyes)]
[h:setProperty("Eyes",props,id)]
[h:props=setStrProp("","value",Skin)]
[h:setProperty("Skin",props,id)]
[h:props=setStrProp("","value",Hair)]
[h:setProperty("Hair",props,id)]


